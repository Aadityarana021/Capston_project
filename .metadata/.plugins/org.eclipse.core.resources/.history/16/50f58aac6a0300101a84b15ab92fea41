package stepDefinitions.accountSummary_TC11;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import io.cucumber.java.en.*;
import org.openqa.selenium.By;
import static org.testng.Assert.*;
import java.time.Duration;

import stepDefinitions.accountSummary_TC4.AccountSummaryLoginSteps_TC4;

public class PayBillsEmptyAmountSteps_TC11 {
    WebDriver driver = AccountSummaryLoginSteps_TC4.getDriver();
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));

    @When("User navigates to Pay Bills page")
    public void user_navigates_to_pay_bills() {
        wait.until(ExpectedConditions.elementToBeClickable(By.xpath("//strong[normalize-space()='Online Banking']"))).click();
        wait.until(ExpectedConditions.elementToBeClickable(By.id("account_summary_link"))).click();
        wait.until(ExpectedConditions.elementToBeClickable(By.id("pay_bills_tab"))).click();
    }

    @When("User enters a payment date {string}")
    public void user_enters_payment_date(String date) {
        wait.until(ExpectedConditions.elementToBeClickable(By.id("sp_date"))).sendKeys(date);
    }

    @When("User clicks on Pay without entering amount")
    public void user_clicks_pay_without_amount() {
        wait.until(ExpectedConditions.elementToBeClickable(By.id("pay_saved_payees"))).click();
    }

    @Then("User should see a pop-up message since the amount field is empty")
    public void verify_error_message() {
        try {
            // Check if the browser's default validation popup appears
            String validationMessage = driver.findElement(By.id("sp_amount")).getAttribute("validationMessage");
            System.out.println("❌ Unable to see expected error message. Instead, browser validation popup appeared: " + validationMessage);
            assertTrue(validationMessage.contains("Please fill out this field"), "Test Passed: Validation message appeared.");
        } catch (Exception e) {
            fail("❌ No validation message found!");
        }
    }
}
