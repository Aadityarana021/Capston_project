package stepDefinitions.accountSummary_TC7;

import org.openqa.selenium.WebDriver;
import org.testng.Assert;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import pageObjects.FundTransferInsufficientBalancePage_TC7;
import stepDefinitions.CommonSteps;
import stepDefinitions.accountSummary_TC4.AccountSummaryLoginSteps_TC4;

public class FundTransferInsufficientBalanceSteps_TC7 {
    WebDriver driver;
    FundTransferInsufficientBalancePage_TC7 transferFundsPage;
    CommonSteps commonSteps;

    public FundTransferInsufficientBalanceSteps_TC7() {
        this.driver = AccountSummaryLoginSteps_TC4.getDriver(); // ✅ Get driver from TC4
        if (driver == null) {
            throw new IllegalStateException("❌ WebDriver is NULL in TC7.");
        }
        this.transferFundsPage = new FundTransferInsufficientBalancePage_TC7(driver);
        this.commonSteps = new CommonSteps(driver); // ✅ Use fixed CommonSteps
    }

    @When("User navigates to Transfer Funds page")
    public void user_navigates_to_transfer_funds() {
        commonSteps.user_navigates_to_transfer_funds(); // ✅ Calls CommonSteps method
    }

    @When("User selects an account with insufficient funds as {string}")
    public void user_selects_insufficient_funds_account(String accountType) {
        transferFundsPage.selectInsufficientFundsAccount();
    }

    @When("User enters an amount greater than the available balance")
    public void user_enters_excess_amount() {
        transferFundsPage.enterExcessAmount(); // ✅ Fixed method call
    }

    @When("User clicks on Submit")
    public void user_clicks_submit() {
        transferFundsPage.clickSubmit();
    }

    @Then("User should see an error message {string}")
    public void verify_error_message(String expectedMessage) {
        String actualMessage = transferFundsPage.getErrorMessage();

        System.out.println("Expected Error: " + expectedMessage);
        System.out.println("Actual Message: " + actualMessage);

        Assert.assertTrue(actualMessage.contains(expectedMessage), "❌ Error message mismatch!");
    }

    @Then("Transfer should not be processed")
    public void transfer_should_not_be_processed() {
        Assert.assertFalse(driver.getCurrentUrl().contains("success"), "❌ Transfer should have failed!");
    }
}
