package stepDefinitions.accountSummary_TC16;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import io.cucumber.java.en.*;
import java.time.Duration;
import static org.testng.Assert.assertTrue;

public class VerifySessionExpirySteps_TC16 {
    WebDriver driver = stepDefinitions.accountSummary_TC4.AccountSummaryLoginSteps_TC4.getDriver();
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));

    @When("User clicks on the Logout button")
    public void user_clicks_on_logout_button() {
        wait.until(ExpectedConditions.elementToBeClickable(By.id("settingsBox"))).click();
        wait.until(ExpectedConditions.elementToBeClickable(By.id("logout_link"))).click();
    }

    @Then("User should be redirected to the login page")
    public void verify_user_redirected_to_login_page() {
        boolean isLoginPage = wait.until(ExpectedConditions.or(
            ExpectedConditions.urlContains("login.html"),
            ExpectedConditions.presenceOfElementLocated(By.id("user_login"))
        ));
        
        assertTrue(isLoginPage, "❌ Logout failed! User is NOT on the login page.");
        System.out.println("✅ Logout successful. User is redirected to the login page.");
    }

    @And("User clicks the browser back button")
    public void user_clicks_browser_back_button() {
        driver.navigate().back();
    }

    @Then("User should not be able to access the previous page after logout")
    public void verify_session_expiry_after_logout() {
        boolean isOnLoginPage = wait.until(ExpectedConditions.or(
            ExpectedConditions.urlContains("login.html"),
            ExpectedConditions.presenceOfElementLocated(By.id("user_login"))
        ));

        assertTrue(isOnLoginPage, "❌ Session is NOT expired! User accessed a secure page after logout.");
        System.out.println("✅ Session expired. User cannot access the previous page after logout.");
    }
}
