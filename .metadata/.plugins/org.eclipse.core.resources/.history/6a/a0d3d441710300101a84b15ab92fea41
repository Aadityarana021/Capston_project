package stepDefinitions.accountSummary_TC12;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import io.cucumber.java.en.*;
import utilities.ScreenshotUtil;
import java.time.Duration;
import static org.testng.Assert.assertTrue;

public class AddNewPayeeSteps_TC12 {
    WebDriver driver;
    WebDriverWait wait;

    public AddNewPayeeSteps_TC12() {
        driver = stepDefinitions.accountSummary_TC4.AccountSummaryLoginSteps_TC4.getDriver();
        wait = new WebDriverWait(driver, Duration.ofSeconds(10));
    }

    @When("User navigates to Pay Bills page")
    public void navigate_to_pay_bills() {
        wait.until(ExpectedConditions.elementToBeClickable(By.xpath("//strong[text()='Online Banking']"))).click();
        wait.until(ExpectedConditions.elementToBeClickable(By.id("account_summary_link"))).click();
        wait.until(ExpectedConditions.elementToBeClickable(By.id("pay_bills_tab"))).click();
    }

    @And("User clicks on Add New Payee tab")
    public void click_add_new_payee_tab() {
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));

        // Find and click "Add New Payee" tab
        WebElement addNewPayeeTab = wait.until(ExpectedConditions.elementToBeClickable(By.xpath("//a[contains(@class, 'ui-state-default') and contains(@class, 'ui-corner-top')]")));

        addNewPayeeTab.click();

        // Wait until the form is visible
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("np_new_payee_name")));
    }

    @And("User enters new payee details")
    public void enter_payee_details() {
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));

        // Wait for form fields before entering data
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("np_new_payee_name"))).sendKeys("Aditya Rana");
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("np_new_payee_address"))).sendKeys("New Delhi, India");
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("np_new_payee_account"))).sendKeys("SBI Savings Account");
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("np_new_payee_details"))).sendKeys("Personal account of Aditya Rana");
    }


    @When("User clicks on {string} button")
    public void click_add_payee_button(String buttonName) {
        wait.until(ExpectedConditions.elementToBeClickable(By.id("add_new_payee"))).click();
    }

    @Then("User should see a success message {string}")
    public void verify_success_message(String expectedMessage) {
        String actualMessage = wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("alert_content"))).getText();
        System.out.println("✅ Expected: " + expectedMessage);
        System.out.println("✅ Actual: " + actualMessage);
        assertTrue(actualMessage.contains(expectedMessage), "❌ Payee creation failed!");
    }

    @Then("User captures a screenshot for confirmation")
    public void capture_screenshot() {
        ScreenshotUtil.captureScreenshot(driver, "AddNewPayee");
    }
}
